import{t as k,e as G,a as d,c as Z,s as K,h as ue,b as fe}from"../chunks/Dt2qGRMN.js";import{R as ie,$ as me,Y as he,a0 as pe,V as l,W as n,X as C,T as E,U as ne,d as t,e as se,S as V,K as Q,a6 as L,a3 as _,ah as ge,al as le}from"../chunks/C8mbV1xz.js";import{l as oe,p as H,i as y,b as _e,d as U,s as be,f as xe}from"../chunks/cgYqcD7K.js";import{e as ye}from"../chunks/CIEhC5oT.js";import{s as re,b as we,C as Se,d as J,E as Ie,g as qe,c as Ce}from"../chunks/d1E7WoIg.js";import{b as Le}from"../chunks/DvA8B_zy.js";import{p as ke}from"../chunks/h0850DsC.js";import{L as ce,d as de}from"../chunks/CGNSJrrh.js";import{g as De}from"../chunks/BgqBOXdd.js";import{S as Be}from"../chunks/CYteDB-P.js";import{i as Fe}from"../chunks/ByIkZpuU.js";var Me=k("<div> </div>"),Te=k("<div><div><!></div> <!></div>");function Re(D,r){const c=oe(r,["children","$$slots","$$events","$$legacy"]),w=oe(c,["status","description","iconDescription","successDelay"]);ie(r,!1);let v=H(r,"status",8,"active"),f=H(r,"description",8,void 0),b=H(r,"iconDescription",8,void 0),u=H(r,"successDelay",8,1500);const B=me();let o;he(()=>()=>{clearTimeout(o)}),pe(()=>{v()==="finished"&&(o=setTimeout(()=>{B("success")},u()))}),Fe();var i=Te();let N;var F=l(i);re(F,1,"",null,{},{"bx--inline-loading__animation":!0});var O=l(F);{var $=a=>{const m=se(()=>b()||v());Ie(a,{class:"bx--inline-loading--error",get title(){return t(m)}})},W=a=>{var m=Z(),A=V(m);{var j=S=>{const z=se(()=>b()||v());qe(S,{class:"bx--inline-loading__checkmark-container",get title(){return t(z)}})},ee=S=>{var z=Z(),te=V(z);{var ae=e=>{const s=se(()=>v()==="active");ce(e,{small:!0,get description(){return b()},withOverlay:!1,get active(){return t(s)}})};y(te,e=>{(v()==="inactive"||v()==="active")&&e(ae)},!0)}d(S,z)};y(A,S=>{v()==="finished"?S(j):S(ee,!1)},!0)}d(a,m)};y(O,a=>{v()==="error"?a($):a(W,!1)})}n(F);var X=C(F,2);{var Y=a=>{var m=Me();re(m,1,"",null,{},{"bx--inline-loading__text":!0});var A=l(m,!0);n(m),E(()=>K(A,f())),d(a,m)};y(X,a=>{f()&&a(Y)})}n(i),E(()=>N=we(i,N,{"aria-live":"assertive",...w,[Se]:{"bx--inline-loading":!0}})),G("click",i,function(a){J.call(this,r,a)}),G("mouseover",i,function(a){J.call(this,r,a)}),G("mouseenter",i,function(a){J.call(this,r,a)}),G("mouseleave",i,function(a){J.call(this,r,a)}),d(D,i),ne()}const Ee=(D,r)=>{let c=null;return(...w)=>{c&&window.clearTimeout(c),c=window.setTimeout(()=>D(...w),r)}};var Ne=k("<!> <canvas></canvas>",1);function Ae(D,r){ie(r,!0);let c=L(void 0),w=L(!1);Q(()=>{t(c).width=r.width,t(c).height=r.height;const o=t(c).getContext("2d");r.croppedBitmap.then(i=>{o.drawImage(i,0,0),i.close(),_(w,!0)})});var v=Ne(),f=V(v);{var b=o=>{ce(o,{withOverlay:!1,small:!0})};y(f,o=>{t(w)||o(b)})}var u=C(f,2);let B;_e(u,o=>_(c,o),()=>t(c)),E(()=>B=re(u,1,"svelte-1pqnjwx",null,B,{loaded:t(w)})),d(D,v),ne()}var ze=k('<meta name="description" content="Application for investigating MRM outputs">'),Pe=k(" <!>",1),Ue=k("<p> </p>"),Ke=k('<tr class="svelte-lyqmb"><td> </td><td> </td><td><a><!></a></td></tr>'),Ve=k('<table class="bx--data-table bx--data-table--sort svelte-lyqmb"><thead class="svelte-lyqmb"><tr class="svelte-lyqmb"><th aria-sort="none" scope="col" data-header="imageName"><div class="bx--table-header-label">Image</div></th><th aria-sort="none" scope="col" data-header="text"><div class="bx--table-header-label">Feature Text</div></th><th scope="col" data-header="clip"><div class="bx--table-header-label">Clipped Image</div></th></tr></thead><tbody aria-live="polite" class="svelte-lyqmb"></tbody></table>'),We=k('<div class="container svelte-lyqmb"><div class="search svelte-lyqmb"><div class="search-input svelte-lyqmb"><!></div> <div class="search-status svelte-lyqmb"><!> <span class="svelte-lyqmb"> </span></div></div> <!></div>');function tt(D,r){ie(r,!0);const[c,w]=be(),v=()=>xe(ke,"$page",c);let f=L(U([])),b=L(!1),u=L(void 0),B=L(0),o=L(0),i=L(0),N=L(U(new Set));const F=1e3;Q(()=>{de.table("images").each(e=>{e.features&&_(o,t(o)+e.features.length),le(B)})}),Q(()=>{const e=v().url.searchParams.get("s");e&&(_(u,U(e)),$(t(u)))});async function O(e){let s;if(e.features){for(const[I,q]of e.features.entries())if(q.properties.text.toLowerCase().includes(t(u).toLowerCase())){if(t(N).add(e.id),le(i),t(f).length>=F)continue;s||(s=await createImageBitmap(e.imageBlob));const{croppedBitmap:h,width:p,height:x}=De(s,q);t(f).push({key:`${e.id}-${I}`,imageId:e.id,imageName:e.name,featureId:I,text:q.properties.text,width:p,height:x,croppedBitmap:h})}}s&&s.close()}const $=Ee(async e=>{_(i,0),_(N,U(new Set)),_(f,U([])),_(b,!1),e&&(_(b,!0),de.table("images").toArray().then(async s=>{for(const I of s)await O(I);_(b,!1)}))},500);Q(()=>{_(b,!0),$(t(u))});var W=We();ue(e=>{var s=ze();ge.title="Search | MRM Explorer",d(e,s)});var X=l(W),Y=l(X),a=l(Y);Be(a,{get value(){return t(u)},set value(e){_(u,U(e))}}),n(Y);var m=C(Y,2),A=l(m);{var j=e=>{Re(e,{description:"Searching..."})},ee=e=>{var s=Z(),I=V(s);{var q=p=>{var x=Pe(),P=V(x),M=C(P);{var T=g=>{var R=fe("(max 1,000 shown)");d(g,R)};y(M,g=>{t(i)>F&&g(T)})}E(g=>K(P,`${g??""} matches found in ${t(N).size??""} image(s) `),[()=>t(i).toLocaleString()]),d(p,x)},h=p=>{var x=Z(),P=V(x);{var M=T=>{var g=Ue(),R=l(g);n(g),E(()=>K(R,`No results found for "${t(u)??""}"`)),d(T,g)};y(P,T=>{t(u)!==""&&T(M)},!0)}d(p,x)};y(I,p=>{t(f).length?p(q):p(h,!1)},!0)}d(e,s)};y(A,e=>{t(b)?e(j):e(ee,!1)})}var S=C(A,2),z=l(S);n(S),n(m),n(X);var te=C(X,2);{var ae=e=>{var s=Ve(),I=C(l(s));ye(I,21,()=>t(f),q=>q.key,(q,h)=>{var p=Ke(),x=l(p),P=l(x,!0);n(x);var M=C(x),T=l(M);n(M);var g=C(M),R=l(g),ve=l(R);Ae(ve,{get croppedBitmap(){return t(h).croppedBitmap},get width(){return t(h).width},get height(){return t(h).height}}),n(R),n(g),n(p),E(()=>{K(P,t(h).imageName),K(T,`${t(h).text??""} (${t(h).featureId??""})`),Ce(R,"href",`${Le}/view/?id=${t(h).imageId}&feat=${t(h).featureId}`)}),d(q,p)}),n(I),n(s),d(e,s)};y(te,e=>{t(f).length&&e(ae)})}n(W),E((e,s)=>K(z,`Searching ${e??""} features across ${s??""} images`),[()=>t(o).toLocaleString(),()=>t(B).toLocaleString()]),d(D,W),ne(),w()}export{tt as component};
