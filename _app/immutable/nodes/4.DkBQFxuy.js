import{u as C,c as F,Y as N,k as p,q as T,d as q,l as w,b as y,U as J,j as U,$ as K,Z as Q,a as I,e as x,L as v,E as V}from"../chunks/disclose-version.C3L7z7x-.js";import{a as Y,g as r,p as Z,c as R,s as L,t as W,e as b,E as X}from"../chunks/runtime.CsqbjnXD.js";import{i as E,u as $,p as B}from"../chunks/main-client.B0L5hVVe.js";import{u as ee,s as te}from"../chunks/store.BHBXFUgZ.js";import{p as ae}from"../chunks/stores.CYoNdChF.js";import{L as re,d as P}from"../chunks/db.DVEEUmQX.js";import{S as se}from"../chunks/Search.BtyobBQl.js";const ne=(m,n)=>{let u=null;return(...M)=>{u&&window.clearTimeout(u),u=window.setTimeout(()=>m(...M),n)}};var oe=y('<img loading="lazy" class="svelte-1mfiv7r">');function ie(m,n){Y(n,!0);let u=R(void 0);const M=a=>[Math.min(...a.map(([e])=>e)),Math.min(...a.map(([,e])=>e)),Math.max(...a.map(([e])=>e)),Math.max(...a.map(([,e])=>e))];C(()=>{if(!n.imageObject||!n.feature)return;const a=n.feature.geometry.coordinates[0].map(([l,d])=>[l,1-d]),e=M($(a)),f=e[3]-e[1],g=e[2]-e[0];console.log(e,f,g);const _=new Image;_.onload=()=>{const l=document.createElement("canvas"),d=l.getContext("2d");l.width=g,l.height=f,d==null||d.drawImage(_,e[0],e[1],g,f,0,0,g,f),l.toBlob(j=>{L(u,B(j))})},W().then(()=>_.src=URL.createObjectURL(n.imageObject.imageBlob))});var o=T(m),c=q(o);E(c,()=>r(u),a=>{var e=w(a,!0,oe);N(e,"src",()=>URL.createObjectURL(r(u))),N(e,"alt",()=>`"${n.feature.properties.text}" (${n.imageObject.name})`),p(a,e)},a=>{var e=T(a),f=q(e);re(f,{withOverlay:!1,small:!0}),F(a,e)}),F(m,o),Z()}var ue=y('<meta name="description" content="Application for investigating MRM outputs">'),le=y("<p> </p>"),ce=y('<li class="svelte-1x1tu2o"> <!></li>'),fe=y('<ul class="svelte-1x1tu2o"></ul>'),me=y('<div class="container svelte-1x1tu2o"><div class="search svelte-1x1tu2o"><!> <span> <!></span></div> <!></div>');function we(m,n){Y(n,!0);const u={};ee(u);const M=()=>te(ae,"$page",u);let o=R(void 0),c=R(void 0),a=R(0),e=R(0);C(()=>{P.table("images").each(t=>{t.features&&L(e,r(e)+t.features.length),X(a)})}),C(()=>{const t=M().url.searchParams.get("s");t&&L(c,B(t))});const f=ne(t=>{if(!t){L(o,void 0);return}const s=[];P.table("images").each(i=>{if(i.features)for(const[S,k]of i.features.entries())k.properties.text.toLowerCase().includes(t.toLowerCase())&&s.push({imageObject:i,feature:k,featureIdx:S,key:`${i.id}-${S}`})}).then(()=>L(o,B(s.slice(0,50))))},500);C(()=>f(r(c)));var g=w(m,!0,me);J(t=>{var s=w(t,!0,ue);K.title="Search | MRM Explorer",p(t,s)});var _=I(g),l=I(_),d=x(x(l,!0)),j=I(d),D=x(j),G=x(x(_,!0));U(j,()=>`Searching ${v(r(e).toLocaleString())} features across ${v(r(a).toLocaleString())} images `),se(l,{get value(){return r(c)},set value(t){L(c,B(t))}}),E(D,()=>r(o),t=>{var s=V(t);U(s,()=>{var i;return`-- found ${v((i=r(o))==null?void 0:i.length.toLocaleString())} matches`}),p(t,s)},null),E(G,()=>r(c)&&r(o)&&r(o).length===0,t=>{var s=w(t,!0,le),i=I(s);U(i,()=>`No results found for "${v(r(c))}"`),p(t,s)},t=>{var s=T(t),i=q(s);E(i,()=>r(o),S=>{var k=w(S,!0,fe);Q(k,()=>r(o),77,(O,h)=>b(O).key,(O,h,ge)=>{var z=w(O,!0,ce),A=I(z),H=x(A);U(A,()=>`${v(b(h).imageObject.name)} - (${v(b(h).featureIdx)}) ${v(b(h).feature.properties.text)} `),ie(H,{get imageObject(){return b(h).imageObject},get feature(){return b(h).feature}}),p(O,z)},null),p(S,k)},null),F(t,s)}),p(m,g),Z()}export{we as component};
