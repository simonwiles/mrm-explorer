import{t as g,a as $}from"./Dt2qGRMN.js";import{R as w,a6 as y,U as W,a3 as l,d as p}from"./C8mbV1xz.js";import{d as n,c as k,r as v}from"./cgYqcD7K.js";import{b as A}from"./DvA8B_zy.js";import{u as D}from"./CGNSJrrh.js";import{n as I}from"./SunQdChT.js";import{F as U}from"./BnJxqDPR.js";function x(t){return new Worker(""+new URL("../workers/imageScalingWorker-1SXlG9Dm.js",import.meta.url).href,{name:t==null?void 0:t.name})}var F=g('<span class="file-upload-dropzone svelte-gbcpcd" slot="labelText">Drag and drop map or other image here<br>(or click to upload)</span>');function M(t,o){w(o,!0);let m=v(o,["$$slots","$$events","$$legacy","redirectOnAdd"]),s=y(n([]));async function c(e){D(e).then(([,a])=>{if(a===null){console.error(`Failed to add ${e.name}: ${e}`);return}I({title:"Image Added",subtitle:`Image "${a.name}" added (ID is ${a.id})`}),o.redirectOnAdd&&(window.location.href=p(s).length===1?`${A}/view/?id=${a.id}`:"/dataset/"),l(s,n([]))})}async function u(e,a){const r=new Image;r.src=URL.createObjectURL(a),r.decode().then(()=>{const d=new MessageChannel,i=new x;d.port2.onmessage=({data:h})=>{c({name:e,imageBlob:a,width:r.naturalWidth,height:r.naturalHeight,imageThumbBlob:h}),i.terminate()},i.postMessage({imageBlob:a,w:r.naturalWidth/r.naturalHeight*320,h:320},[d.port1])})}function f(e){if(!e.type||!e.type.startsWith("image/")){alert(`Only image files are accepted (file "${e.name}" rejected).`);return}u(e.name,e)}U(t,k({multiple:!0},()=>m,{get files(){return p(s)},set files(e){l(s,n(e))},$$events:{change:({detail:e})=>{e.forEach(a=>f(a))}},$$slots:{labelText:(e,a)=>{var r=F();$(e,r)}}})),W()}export{M as A};
